#!/bin/bash

export DISPLAY=:0.0

i3status -c ~/.config/i3/i3status | awk -v warning=10 -v error=3 -v hibernate=1 '{
if($1 == "DOWN") {
    print "✕";
} else if($1 == "CHR") {
    gsub(/%/, "", $2);
    level = $2 / 20;
    level = substr("", 1*level, 1);
    printf("⚡%s\n", level);
} else if($1 == "BAT") {
    gsub(/%/, "", $2);
    level = $2 / 20;
    level = substr("", 1*level, 1);
    print level;

    if($2 <= hibernate) {
       system("i3-msg -t command fullscreen disable >/dev/null 2>&1;\
               notify-send -i notification-battery-low -u critical -t 3000 Battery \"%"$2" remaining, suspend system ...\" >/dev/null 2>&1;\
               sleep 3;\
               systemctl suspend >/dev/null 2>&1")
    } else if($2 <= error) {
       system("i3-msg -t command fullscreen disable >/dev/null 2>&1;\
               notify-send -i notification-battery-low -u normal -t 3000 Battery \"%"$2" remaining\" >/dev/null 2>&1");
    } else if($2 <= warning) {
       system("i3-msg -t command fullscreen disable >/dev/null 2>&1;\
               notify-send -i notification-battery-low -u low -t 3000 Battery \"%"$2" remaining\" >/dev/null 2>&1");
    }
} else if($1 == "FULL") {
    print "";
} else {
    print $0;
};
fflush();
}'
